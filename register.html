<!DOCTYPE html>
<html>
<head>
    <title>ƒêƒÉng k√Ω s·ª≠ d·ª•ng Firmware</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <meta name="color-scheme" content="dark light">
    <meta name="description" content="ƒêƒÉng k√Ω s·ª≠ d·ª•ng firmware OneHUD">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .register-container {
            display: flex;
            gap: 40px;
            width: 100%;
            max-width: 1240px;
            margin: 30px auto 0;
            align-items: flex-start;
        }
        
        .register-form {
            flex: 1;
            min-width: 0;
        }
        
        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--primary);
            font-size: 16px;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: #fff;
            color: #333;
            box-sizing: border-box;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .form-note {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 1px solid #ffc107;
        }
        
        .form-note p {
            color: #856404;
            font-size: 14px;
            font-weight: 600;
            margin: 0;
        }
        
        .payment-section {
            flex: 0 0 420px;
            background: #ffffff;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #ddd;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .payment-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: 700;
        }
        
        .payment-info {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 15px;
            font-weight: 600;
        }
        
        .qrcode-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .qrcode-image {
            max-width: 360px;
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 3px solid #f0f0f0;
        }
        
        .status-message {
            margin-top: 20px;
            padding: 14px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            display: none;
            font-size: 15px;
        }
        
        .status-info {
            background: #e7f3ff;
            color: #0066cc;
            border: 2px solid #b3d9ff;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .fa-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @media (prefers-color-scheme: dark) {
            .form-group label,
            .payment-section h3 {
                color: var(--primary) !important;
            }
            .payment-info {
                color: var(--accent) !important;
            }
        }
        
        @media (max-width: 768px) {
            .register-container {
                flex-direction: column;
            }
            .payment-section {
                flex: 0 0 auto;
            }
            .qrcode-image {
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <main class="main-content">
            <div class="flash-section">
                <div class="flash-card">
                    <div class="device-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <h2>ƒêƒÉng k√Ω s·ª≠ d·ª•ng Firmware</h2>
                    <p>ƒêƒÉng k√Ω ƒë·ªÉ nh·∫≠n quy·ªÅn truy c·∫≠p v√† s·ª≠ d·ª•ng firmware ch√≠nh th·ª©c</p>
                    
                    <div class="register-container">
                        <div class="register-form">
                            <div class="form-group">
                                <label for="email">
                                    <i class="fas fa-envelope"></i> Email nh·∫≠n th√¥ng tin
                                </label>
                                <input 
                                    type="email" 
                                    id="email" 
                                    placeholder="name@example.com" 
                                    required
                                    class="form-input"
                                >
                            </div>
                            
                            <div class="form-note">
                                <p>üí° Sau khi thanh to√°n th√†nh c√¥ng qua QR code b√™n ph·∫£i, vui l√≤ng nh·∫•n n√∫t b√™n d∆∞·ªõi ƒë·ªÉ th√¥ng b√°o</p>
                            </div>
                            
                            <div class="button-row">
                                <button id="registerBtn" class="btn btn-primary btn-large">
                                    <i class="fas fa-check-circle btn-icon"></i>
                                    Th√¥ng b√°o ƒë√£ chuy·ªÉn ti·ªÅn
                                </button>
                            </div>
                            
                            <div id="statusMessage" class="status-message"></div>
                        </div>
                        
                        <div class="payment-section">
                            <h3><i class="fas fa-credit-card"></i> Thanh to√°n</h3>
                            <p class="payment-info">Qu√©t m√£ QR ƒë·ªÉ thanh to√°n ph√≠ ƒëƒÉng k√Ω</p>
                            <div class="qrcode-container">
                                <img src="qrcode.jpg" alt="QR Code Thanh To√°n" class="qrcode-image">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <section class="instructions">
                <h2><i class="fas fa-list-ol"></i> H∆∞·ªõng d·∫´n ƒëƒÉng k√Ω</h2>
                <div class="steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Nh·∫≠p email</h3>
                            <p>ƒêi·ªÅn ƒë·ªãa ch·ªâ email ƒë·ªÉ nh·∫≠n link firmware v√† th√¥ng tin c·∫≠p nh·∫≠t</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>Thanh to√°n</h3>
                            <p>Qu√©t m√£ QR ƒë·ªÉ thanh to√°n ph√≠ ƒëƒÉng k√Ω s·ª≠ d·ª•ng firmware</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Th√¥ng b√°o ƒë√£ chuy·ªÉn ti·ªÅn</h3>
                            <p>Sau khi thanh to√°n th√†nh c√¥ng, nh·∫•n "Th√¥ng b√°o ƒë√£ chuy·ªÉn ti·ªÅn". Ch√∫ng t√¥i s·∫Ω ki·ªÉm tra v√† g·ª≠i link firmware cho b·∫°n qua email</p>
                        </div>
                    </div>
                </div>
            </section>
            
        </main>
        
        <footer>
            <p>&copy; <span id="currentYear"></span> OneHUD Team</p>
            <p class="build-info">Version: <span id="appVersion">2.0.2</span></p>
        </footer>
    </div>
    
    <!-- SCRIPTS -->
    <script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"></script>
    <script type="module">
    // DOM Ready
    const registerBtn = document.getElementById("registerBtn");
    const emailInput = document.getElementById("email");
    const statusMessage = document.getElementById("statusMessage");
    const currentYearElement = document.getElementById('currentYear');
    if (currentYearElement) currentYearElement.textContent = new Date().getFullYear();

    function showStatus(msg, type = 'info') {
      statusMessage.textContent = msg;
      statusMessage.className = 'status-message status-' + type;
      statusMessage.style.display = 'block';
    }

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    async function getDeviceMac() {
      try {
        const port = await navigator.serial.requestPort();
        await port.open({ baudRate: 115200 });
        const ESPLoader = window["esp-web-tools"].ESPLoader;
        const loader = new ESPLoader(port, { log: ()=>{} });
        await loader.main_fn();
        const mac = await loader.macAddr();
        await loader.disconnect();
        await port.close();
        return mac;
      } catch (e) {
        throw new Error('Kh√¥ng th·ªÉ nh·∫≠n di·ªán thi·∫øt b·ªã!');
      }
    }

    async function sendTelegram(email, mac) {
      const botToken = '8464026703:AAFd_w4fL09HFaZ3s_LI81tLJJhyvt0whWs';
      const chatId = '7158639072';
      const message = `üÜï ƒêƒÉng k√Ω m·ªõi!\n\nüìß Email: ${email}\nüîê MAC: ${mac}\n‚è∞ Th·ªùi gian: ${new Date().toLocaleString('vi-VN')}`;
      const apiUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;
      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: chatId, text: message, parse_mode: 'HTML' })
      });
      if (!response.ok) throw new Error('Kh√¥ng th·ªÉ g·ª≠i d·ªØ li·ªáu!');
    }

    registerBtn.addEventListener('click', async function () {
      const email = emailInput.value.trim();
      if (!validateEmail(email)) {
        showStatus('‚ùå Vui l√≤ng nh·∫≠p email h·ª£p l·ªá!', 'error');
        return;
      }
      registerBtn.disabled = true;
      try {
        const mac = await getDeviceMac();
        await sendTelegram(email, mac);
        showStatus('‚úÖ Th√¥ng b√°o ƒë√£ g·ª≠i. Ch√∫ng t√¥i s·∫Ω ph·∫£n h·ªìi qua email sau khi x√°c nh·∫≠n.', 'success');
        emailInput.disabled = true;
      } catch (e) {
        showStatus('‚ùå C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.', 'error');
        registerBtn.disabled = false;
      }
    });
    </script>
</body>
</html>

